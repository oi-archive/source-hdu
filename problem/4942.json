{"title":"Game on Sâ™‚play","time_limit":8000,"memory_limit":128,"operation":{"submit":"http://acm.hdu.edu.cn/submit.php?pid=4942","submissions":"http://acm.hdu.edu.cn/status.php?first=&pid=4942&user=&lang=0&status=0","statistics":"http://acm.hdu.edu.cn/statistic.php?pid=4942","discussion":"http://acm.hdu.edu.cn/discuss/problem/list.php?problemid=4942"},"statement":[{"title":"Problem Description","content":"   Uncle Fang is learning Splay. When he heard about the rotate operation, he would like to play a game with Captain Chen. There is a tree with n nodes initially, and the node 1 is the root. The i-th nodes gets a weight of wi, and an attribute of interesting value defined as the sum of the weight of it&#x2019;s descendants. Following are two operations in this tree:<br><br>   1.do a rotation on a node x. The rotation is the common rotation in splay tree, it can be right-rotation or left-rotation, as demonstrated in the following picture.<b>If it&apos;s impossible to rotate, just ignore it!</b><br><br><center><img style=\"max-width:100%;\" src=\"../../data/images/C508-1008-1.jpg\"></center> <br>   2.ask Captain Chen the product of interesting values of the nodes in a subtree rooted at node x.","type":"description","format":"html"},{"title":"Input","content":"   There are several cases.The first line of the input contains a single integer T (T &lt;= 30) which is the number of test cases.Then comes the T test cases .<br><br>   For each case, the first line contains two integer numbers n and m(1&lt;=n, m&lt;=100000).<br><br>   The following n lines describe the tree. In the i-th line, there was three number wi, xi, yi,(0&lt;=w&lt;=100000, 0&lt;=x, y&lt;=n) indicate the weight of node i, the left child of node i, and the right child of node i. If xi or yi equals to 0, it means node i has no such child.<br><br>   And the following m lines describe the operations. There are two numbers p x in each line. If p is 0, it means do right-rotation on node x; If p is 1, it means do left-rotation on node <b>x</b>; if p is 2, it means ask the product of interesting values of the nodes in a subtree rooted at node x.","type":"input_format","format":"html"},{"title":"Output","content":"   For the k-th test case, first output &#x201C;Case #k:&#x201D; in a separate line.Then for each query,output a single num in each line after mod 1000000007.","type":"output_format","format":"html"},{"title":"Sample Input","content":"<pre><div style=\"font-family:Courier New,Courier,monospace;\">1\n3 4\n1 2 3\n1 0 0\n1 0 0\n2 1\n0 1\n2 2\n2 1</div></pre>","type":"example","format":"html"},{"title":"Sample Output","content":"<pre><div style=\"font-family:Courier New,Courier,monospace;\">Case #1:\n3\n6\n2\n\n<div style=\"font-family:Times New Roman;font-size:14px;background-color:F4FBFF;border:#B7CBFF 1px dashed;padding:6px\"><div style=\"font-family:Arial;font-weight:bold;color:#7CA9ED;border-bottom:#B7CBFF 1px dashed\"><i>Hint</i></div>As the input data may cause the stack overflow if you use some recursion solution.\nAdd #pragma comment (linker,&quot;/STACK:102400000,102400000&quot;) in C++ language.</div><i style=\"font-size:1px\"> </i></div></pre>","type":"example","format":"html"},{"title":"Author","content":"UESTC","type":"source","format":"html"},{"title":"Source","content":" <a href=\"/search.php?field=problem&amp;key=2014+Multi-University+Training+Contest+7&amp;source=1&amp;searchmode=source\"> 2014 Multi-University Training Contest 7 </a> ","type":"source","format":"html"}]}