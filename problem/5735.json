{"title":"Born Slippy","time_limit":6000,"memory_limit":256,"operation":{"submit":"http://acm.hdu.edu.cn/submit.php?pid=5735","submissions":"http://acm.hdu.edu.cn/status.php?first=&pid=5735&user=&lang=0&status=0","statistics":"http://acm.hdu.edu.cn/statistic.php?pid=5735","discussion":"http://acm.hdu.edu.cn/discuss/problem/list.php?problemid=5735"},"statement":[{"title":"Problem Description","content":"Professor Zhang has a rooted tree, whose vertices are conveniently labeled by $1,2,...,n$. And the $i$-th vertex is assigned with weight $w_i$.<br><br>For each $s \\in \\{1,2,...,n\\}$, Professor Zhang wants find a sequence of vertices $v_1,v_2,...,v_m$ such that:<br><br>1. $v_1=s$ and $v_i$ is the ancestor of $v_{i-1}$ $(1 &lt; i \\le m)$.<br>2. the value $f(s)=w_{v_1}+\\sum\\limits_{i=2}^{m}w_{v_i} \\text{ opt } w_{v_{i-1}}$ is maximum. Operation $x \\text{ opt } y$ denotes bitwise AND, OR or XOR operation of two numbers.","type":"description","format":"html"},{"title":"Input","content":"There are multiple test cases. The first line of input contains an integer $T$, indicating the number of test cases. For each test case:<br><br>The first line contains an integer $n$ and a string $opt$ $(2 \\le n \\le 2^{16}, opt \\in \\{\\text{AND}, \\text{OR}, \\text{XOR}\\}$) -- the number of vertices and the operation. The second line contains $n$ integers $w_1,w_2,...,w_n$ $(0 \\le w_i &lt; 2^{16})$. The thrid line contain $n-1$ integers $f_2,f_3,...,f_n$ $(1 \\le f_i &lt; i)$, where $f_i$ is the father of vertex $i$.<br><br>There are about $300$ test cases and the sum of $n$ in all the test cases is no more than $10^6$.","type":"input_format","format":"html"},{"title":"Output","content":"For each test case, output an integer $S=(\\sum\\limits_{i=1}^{n}{i \\cdot f(i)}) \\text{ mod } (10^9 + 7)$.","type":"output_format","format":"html"},{"title":"Sample Input","content":"<pre><div style=\"font-family:Courier New,Courier,monospace;\">3\n5 AND\n5 4 3 2 1\n1 2 2 4\n5 XOR\n5 4 3 2 1\n1 2 2 4\n5 OR\n5 4 3 2 1\n1 2 2 4</div></pre>","type":"example","format":"html"},{"title":"Sample Output","content":"<pre><div style=\"font-family:Courier New,Courier,monospace;\">91\n139\n195</div></pre>","type":"example","format":"html"},{"title":"Author","content":"zimpha","type":"source","format":"html"},{"title":"Source","content":" <a href=\"/search.php?field=problem&amp;key=2016+Multi-University+Training+Contest+2&amp;source=1&amp;searchmode=source\"> 2016 Multi-University Training Contest 2 </a> ","type":"source","format":"html"}]}