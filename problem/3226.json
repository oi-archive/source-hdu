{"title":"Game Simulator","time_limit":1000,"memory_limit":32,"operation":{"submit":"http://acm.hdu.edu.cn/submit.php?pid=3226","submissions":"http://acm.hdu.edu.cn/status.php?first=&pid=3226&user=&lang=0&status=0","statistics":"http://acm.hdu.edu.cn/statistic.php?pid=3226","discussion":"http://acm.hdu.edu.cn/discuss/problem/list.php?problemid=3226"},"statement":[{"title":"Problem Description","content":"&#x201C;Tractor&#x201D; is a very popular poker game in China. There are four players in the game. Suppose their names are Alice, Bob, Charles and David, in clockwise order. A judge is needed for this game. The players are divided into two teams, Alice and Charles are in team 1, and the other two are in team 2. The prop they use to play the game are two decks of pokers, including 108 cards in total. A simplified rule of the game is described below.<br><br>The whole game contains a number of rounds. In each round, one team is called <b>&#x201C;Declarers&#x201D; (CT)</b>; the other team is called <b>&#x201C;Defenders&#x201D; (FT)</b>. Each team has a <b>current rank (CR)</b>. The goal of the player is to increase his own team&apos;s CR as much as possible.<br><br>A certain round has a <b>Main Suit</b> (Heart - H, Spade - S, Club - C, Diamond - D, or <b><i>None - no main suit</i></b> in this round) and its CR. The CR in this round is the CR of the CT, and Main Suit will be given. The Main Suit and CR will be used to determine the order of the cards.<br><br><b><i>Cards ranked 5, 10, King value 5, 10, 10 pts (points) respectively, all other cards value 0 pts</i></b>. In one round, we only consider the FT&apos;s pts. The rules of getting pts for FT will be discussed later.<br><br>If the FT gets less than 80 pts in one round, they will hold be FT in the next round. This situation is called <b>&#x201C;make&#x201D;</b>. Otherwise, they become CT in the next round and the original CT become FT instead. This situation is called <b>&#x201C;down&#x201D;</b>.<br><br>If the FT gets 0 pts, the CR of the current CT will be increased by 3, for example, if the CR of the CT is 9, it will become Queen (12). Otherwise, if the FT gets less than 40 pts, the CR of the CT will be increased by 2. Otherwise, if the FT gets less than 80 pts, the CR of the CT will be increased by 1. Otherwise, if the FT gets not less than <i>80 + k * 40</i> pts and less than <i>120 + k * 40</i> pts, the CR of the current FT will be increased by k. For example, if the FT gets 255 pts in a round, the CR of the current FT will be increased by 4; and if the FT gets 80 pts, both teams&apos; CR remain unchanged. If a team&apos;s CR becomes <b><i>beyond Ace</i></b>, this team is considered the WINNER of the whole game.<br><br>During a round, one of the players in CT is called the <b>dealer</b>. If &#x201C;make&#x201D;, the pard (teammate) of the dealer becomes the next round&#x2019;s dealer. Otherwise (&#x201C;down&#x201D;), the player on dealer&apos;s right-hand side becomes the dealer of the next round. For example, if the dealer of the current round is Alice and her team (CT) is &#x201C;down&#x201D;, the dealer of the next round should be Bob (on Alice&apos;s right-hand side).<br><br>At the start of a round, each of the players except the dealer gets exactly 25 cards; the dealer gets all the remaining 33 cards. After that, the dealer chooses 8 of his cards and gives them to the judge, and these cards are called <b>&#x201C;hidden cards&#x201D;</b>.<br><br>Now each player has exactly 25 cards. A round consists of several <b>tricks</b>. In the first trick, the dealer plays one or more cards (called <b>&#x201C;lead&#x201D;</b>), then, in clockwise order, players play the same number of cards as the first player one by one (called <b>&#x201C;follow&#x201D;</b>). The winner of the current trick leads cards during the next trick, and so on. <b><i>If the winner of the current trick is a member of FT, then the FT gets the sum of the cards&apos; pts played in this trick.</i></b><br><br>Now we start to describe how to determine the winner of a trick. After the main suit and the CR of the current round are fixed, we can determine the <b>&#x201C;trumps&#x201D;</b> which are cards with main suit or CR (Current Rank), and the Jokers. All other cards are <b>&#x201C;not-trumps&#x201D;</b>.<br><br>We can have an order among all the cards according the following rules:<br><ul>(1) &#x201C;Trumps&#x201D; are ordered higher than &#x201C;not-trumps&#x201D;.<br><br>(2) For the trumps, the order are listed below:<br><br>     &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Red Joker<br>     &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Black Joker<br>     &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;card with main suit and CR (if exists)<br>     &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;other card with CR<br>     &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;other trumps ordered by their ranks(i.e., A, K, Q, J, T, 9, 8, 7, ..., 3, 2)<br><br>(3) For the &#x201C;not-trumps&#x201D;, they are ordered by their ranks.</ul><br><b><i>Assume in all the description below, in the current round, the CR of the CT is 7.</i></b><br><br><center><img style=\"max-width:100%;\" src=\"../../data/images/3226-1.jpg\"></center><br>Suppose the main suit is H, the cards can be arranged in this order (as an example):<br><br><b>S2 , C2 , D2<br>&lt; S3 , C3 , D3<br>&lt; S4 , C4 , D4<br>&lt; S5 , C5 , D5<br>&lt; S6 , C6 , D6<br>&lt; S8 , C8 , D8<br>&lt; S9 , C9 , D9<br>&lt; ST , FT , CT (T - 10)<br>&lt; SJ , CJ , DJ (J - Jack)<br>&lt; SQ , CQ , DQ (Q - Queen)<br>&lt; SK , CK , DK (K - King)<br>&lt; SA , CA , DA (A - Ace)</b><br>&lt; H2<br>&lt; H3<br>&lt; H4<br>&lt; H5<br>&lt; H6<br>&lt; H8<br>&lt; H9<br>&lt; HT<br>&lt; HJ<br>&lt; HQ<br>&lt; HK<br>&lt; HA<br>&lt; S7 = C7 = D7<br>&lt; H7<br>&lt; BJ (the Black Joker)<br>&lt; RJ (the Red Joker)<br><br>If &#x201C;None&#x201D; during this round, then the pokers can be arranged in this order:<br><br><b>H2 , S2 , C2 , D2<br>&lt; H3 , S3 , C3 , D3<br>&lt; H4 , S4 , C4 , D4<br>&lt; H5 , S5 , C5 , D5<br>&lt; H6 , S6 , C6 , D6<br>&lt; H8 , S8 , C8 , D8<br>&lt; H9 , S9 , C9 , D9<br>&lt; HT , ST , FT , CT<br>&lt; HJ , SJ , CJ , DJ<br>&lt; HQ , SQ , CQ , DQ<br>&lt; HK , SK , CK , DK<br>&lt; HA , SA , CA , DA</b><br>&lt; H7 = S7 = C7 = D7<br>&lt; BJ<br>&lt; RJ<br><br>In these two tables, <b><i>cards written in italic</i></b> are &#x201C;trumps&#x201D;, and <b><i>cards written in boldface</i></b> are &#x201C;not-trumps&#x201D;.<br><br>In each trick, the <b>lead cards</b> (played by the player leading this trick) must be either all &#x201C;trumps&#x201D;, or all &#x201C;not-trumps&#x201D; with same suit.<br><br>The possible <b>structures</b> of the cards are listed below (<b><i>assume the main suit is H and main rank is 7 for the example</i></b>):<br><br><b>Single</b>. A single card, such as D9.<br><br><b>Pair</b>. Two same cards, such as D9D9. But D7S7 is not a pair although their orders are the same.<br><br><b>Tractor</b>. Two or more consecutive-ordered pairs, satisfying the condition that they are all &#x201C;trumps&#x201D;, or all &#x201C;not-trumps&#x201D; with same suit, such as SJSJSQSQSKSKSASA, H7H7S7S7HAHA or RJRJBJBJ. But, these are not tractors: S7S7C7C7 (their orders are the same), C7C7C6C6 (they are not consecutive-ordered), DADAD2D2 (Ace is not &#x201C;one&#x201D;, so they are not consecutive-ordered), H2H2H4H4, or D2D2D3. Be careful: if &#x201C;None&#x201D; in this round, H7H7S7S7HAHA is not a tractor (H7 and S7 are same-ordered because of &#x201C;None&#x201D;).<br><br><b>Throw</b>. The combination of the structures above, satisfying the condition that they are all &#x201C;trumps&#x201D;, or all &#x201C;not-trumps&#x201D; with same suit. Each of the Single, Pair or Tractor in a Throw is one of the Throw&#x2019;s component. In the original tractor game, in some situation, the throw will be rejected. But, to keep the rule simple, we assume in this problem all the throws are accepted. For example, RJRJBJBJH7H7HQHQHJHJH9H9H6H6HAH2 contains six components: two tractors, two pairs and two single cards (RJRJBJBJH7H7-HQHQHJHJ-H9H9-H6H6-HA-H2); CACAC8C8CK contains three components: two pairs and one single card(CACA-C8C8-CK).<br><br>A throw can be treated as different list of components, for example, H2H2H3H3H4H4H5H5H6H6 can also be treated as H2H2H3H3-H4H4H5H5H6H6, or H2H2-H3H3H4H4H4H5H5-H6H6, and so on. For the lead cards, each time we choose the longest component (choose the one with the highest order to break the tie) to construct a list of components, this list is the structure of the lead cards, also <b>the structure of the trick</b>. <b><i>So that the structure of the trick is unique.</i></b><br><br>After the first player lead his or her cards, other players follow cards one by one in clockwise order, as mentioned above.<br><br>An important part of the game is to determine the winner of a trick:<br><br>If one&#x2019;s follow cards contain both &#x201C;trumps&#x201D; and &#x201C;not-trumps&#x201D;, or all &#x201C;not-trumps&#x201D; but with different suits, this player can&apos;t be winner of this trick.<br><br>Otherwise, if the lead cards are all &#x201C;not-trumps&#x201D; and one&#x2019;s follow cards contain &#x201C;not-trumps&#x201D; with different suit from the lead cards, this follow player can&#x2019;t be the winner of this trick.<br><br>Else, if one&#x2019;s follow cards can&apos;t be constructed as the same structure of lead cards, this player can&apos;t be the winner of this trick either.<br><br>Otherwise, if the structure of this trick is not &#x201C;throw&#x201D;, the one who played the highest-ordered card wins this trick. If more than one player played the same highest-ordered card, <b><i>the winner of this trick will be the one who plays the highest-ordered card first.</i></b><br><br>Now let&apos;s consider the &#x201C;throw&#x201D; situation. We construct the follow cards into the structure of the lead cards, so that the order of the highest-ordered card in all the longest components of the &#x201C;throw&#x201D; is as high as possible (this card is called <b>&#x201C;honor card&#x201D;</b>). <b><i>Note that tractor can be treated as several pairs or shorter tractors, and pair can be treated as two single cards.</i></b> The winner of this trick is the one who plays the highest-ordered &#x201C;honor card&#x201D;. Similarly, if more than one player played the same highest-ordered &#x201C;honor card&#x201D; the winner of this trick will be the one who plays the highest-ordered &#x201C;honor card&#x201D; first.<br><br>There are many hair-raising rules about lead and follow cards; fortunately, they&apos;re not related to this problem, the only thing we care about is: when someone leads a &#x201C;not-trump&#x201D; &#x201C;throw&#x201D; the only possible way to beat it is to &#x201C;throw&#x201D; the same structure of &#x201C;trumps&#x201D;. And it&#x2019;s impossible to beat a leading &#x201C;trump&#x201D; &#x201C;throw&#x201D;.<br><br><b><i>Special attention on the examples below</i></b>. In these examples, Alice always leads cards. And assume in all the following examples, the CR is 7, and the main suit is H.<br><br><center><img style=\"max-width:100%;\" src=\"../../data/images/3226-2.jpg\"></center><center><img style=\"max-width:100%;\" src=\"../../data/images/3226-3.jpg\"></center><center><img style=\"max-width:100%;\" src=\"../../data/images/3226-4.jpg\"></center><br>There is a special rule about &#x201C;hidden cards&#x201D;: if the winner of the last trick of a certain round is a member of FT, then, in addition, the FT gets the sum of the hidden cards&apos; pts, multiplied by 2<sup>w</sup> (2 to the power of <b>w</b>). <b><i>When the structure of the final trick is not &#x201C;throw&#x201D;, then</i></b> <b>w</b> <b><i>is the number of lead cards of the last trick of this round. If the structure is &#x201C;throw&#x201D; instead,</i></b> <b>w</b> <b><i>is the length of the longest components,</i></b> in the example RJRJBJBJH7H7HQHQHJHJH6H6HA, the <b>w</b> is 6 because the length of RJRJBJBJH7H7 (the longest components of the &#x201C;throw&#x201D;) is 6.<br><br>To make the problem easier, you are only to write a single-round tractor game simulator.","type":"description","format":"html"},{"title":"Input","content":"Multiple test cases, the number of them <b>T</b> is given in the very first line.<br><br>For each test case:<br><br>The first line contains the main suit of this round (H, S, C, D, O; O denotes &#x201C;None&#x201D; in this round), the dealer of this round, the CR of team 1, the CR of team 2, separated by single spaces. Each of the rest lines contains 4 strings: the lead cards and the cards played by the second, third and last player. In one string, the cards can be given in any order. Each player will play exactly 25 cards in one round.<br><br>You may assume the input is always valid.<br><br>There is a blank line between consecutive test cases, and a blank line also appears between <b>T</b> and the first test case.<br>","type":"input_format","format":"html"},{"title":"Output","content":"For each test case:<br><br>The first line contains the case number.<br><br>The second line contains the pts get by the FT in this round.<br><br>If a team wins the whole game after this round, output &#x201C;Winner: Team <b>X</b>&#x201D;(without quotes, <b>X</b> should be either 1 or 2) in the second line. If no team wins, output the new CR of team 1, the new CR of team 2 after this round, followed by the name of the dealer of the next round, separated by single spaces.<br><br>See the example for further details.","type":"output_format","format":"html"},{"title":"Sample Input","content":"<pre><div style=\"font-family:Courier New,Courier,monospace;\">1\n\nO Charles 2 2\nS6S6S7S7 SASKSJST STS8S4S4 S3S5SJSQ\nS9S9 H3D3 S3DT SAD3\nDA DQ DK D4\nSKS8S5S3 RJC2D2H2 C6C8CJD9 H3CKDTD5\nH7H7 H6H4 HJHQ H9H9\nDJDJ DKH5 D5D4 D6D6\nD8D8 C4C3 HTH5 D9D7\nC5C5 C6CT H8HQ C7C4\nH8 C7 HA HA\nH2 RJ BJ CK\nDA BJ C8 HK\nS2S2C2 CQCAD2 HTHJHK C9CQCA</div></pre>","type":"example","format":"html"},{"title":"Sample Output","content":"<pre><div style=\"font-family:Courier New,Courier,monospace;\">Case #1:\n50\n3 2 Alice</div></pre>","type":"example","format":"html"},{"title":"Source","content":" <a href=\"/search.php?field=problem&amp;key=2009+Asia+Shanghai+Regional+Contest+Host+by+DHU&amp;source=1&amp;searchmode=source\"> 2009 Asia Shanghai Regional Contest Host by DHU </a> ","type":"source","format":"html"}]}