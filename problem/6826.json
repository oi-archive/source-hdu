{"title":"An Easy Matrix Problem","time_limit":6000,"memory_limit":128,"operation":{"submit":"http://acm.hdu.edu.cn/submit.php?pid=6826","submissions":"http://acm.hdu.edu.cn/status.php?first=&pid=6826&user=&lang=0&status=0","statistics":"http://acm.hdu.edu.cn/statistic.php?pid=6826","discussion":"http://acm.hdu.edu.cn/discuss/problem/list.php?problemid=6826"},"statement":[{"title":"Problem Description","content":"You are given an array $b[0..n-1]$ of length $n$ and array $a_i = i, i \\in [0,n-1]$.<br><br>Denote $Shift(p,i)$ as an array built from $p$ by \\textbf{right cyclicly shifting} for $i$ elements.<br><br>For example, if $n$ = $3$ and $p$ = $a$, $Shift(p,1)$ = $2,0,1$, and if $n$ = $5$ and $p$ = $a$, $Shift(p,3)$ = $2,3,4,0,1$.<br><br>We define two $n \\times n$ matrixes $A$ and $B$, the $i$-th row of $A$ is $Shift(a,i)$ and the $i$-th row of $B$ is $Shift(b,i)$, $\\forall i \\in [0,n-1]$.<br><br>We define a $n\\times n$ matrix $C = A\\times B$.<br><br><b>This problem contains two sections.</b><br><br><b>For the first section:</b><br><br>You have to answer $m$ queries:<br><br>$0$ $p_x$ $p_y$ $q_x$ $q_y$, you should print ($\\sum_{i=p_x}^{q_x}\\sum_{j=p_y}^{q_y}C_{i,j}^t$) mod $n$, here $t$ meaning the $t$-th power is a parameter <b>fixed</b> for one test case.<br><br><b>For the second section:</b><br><br>You have to answer $q$ queries, and there might be $3$ types:<br><br>$1$ $i$ $k$ $v$, the $i$-th row of $C$ $+=k \\times Shift(a,v)$.<br><br>$2$ $j$ $k$ $v$, the $j$-th column of $C$ $+=k \\times Shift(a,v)$.<br><br>$3$ $p_x$ $p_y$ $q_x$ $q_y$, you should print ($\\sum_{i=p_x}^{q_x}\\sum_{j=p_y}^{q_y}C_{i,j}$) mod $n$.<br><br>Here $a+=b$ denotes that perform $a_i=a_i+b_i, \\forall i \\in [0,n-1]$.<br><br><b>See examples for better understanding.</b><br><br>In the example , the initial matrix $C$: <br><br>$$\\begin{bmatrix}<br>{30}&amp;{20}&amp;{15}&amp;{15}&amp;{20}\\\\<br>{20}&amp;{30}&amp;{20}&amp;{15}&amp;{15}\\\\<br>{15}&amp;{20}&amp;{30}&amp;{20}&amp;{15}\\\\<br>{15}&amp;{15}&amp;{20}&amp;{30}&amp;{20}\\\\<br>{20}&amp;{15}&amp;{15}&amp;{20}&amp;{30}\\\\<br>\\end{bmatrix}$$<br><br>After the first update operation, the matrix $C$ will become:<br><br>$$\\begin{bmatrix}<br>{30}&amp;{20}&amp;{15}&amp;{15}&amp;{20}\\\\<br>{20}&amp;{30}&amp;{20}&amp;{15}&amp;{15}\\\\<br>{23}&amp;{20}&amp;{32}&amp;{24}&amp;{21}\\\\<br>{15}&amp;{15}&amp;{20}&amp;{30}&amp;{20}\\\\<br>{20}&amp;{15}&amp;{15}&amp;{20}&amp;{30}\\\\<br>\\end{bmatrix}$$<br><br>After the second update operation, the matrix $C$ will become:<br><br>$$\\begin{bmatrix}<br>{30}&amp;{20}&amp;{24}&amp;{15}&amp;{20}\\\\<br>{20}&amp;{30}&amp;{32}&amp;{15}&amp;{15}\\\\<br>{23}&amp;{20}&amp;{32}&amp;{24}&amp;{21}\\\\<br>{15}&amp;{15}&amp;{23}&amp;{30}&amp;{20}\\\\<br>{20}&amp;{15}&amp;{21}&amp;{20}&amp;{30}\\\\<br>\\end{bmatrix}$$<br>","type":"description","format":"html"},{"title":"Input","content":"The first line contains a single integer $T$ ($1\\leq T \\leq 3000$) denoting the number of test cases. <br><br>For each test case, the first line contains $4$ single integers $n$,$t$,$m$,$q$ ($1\\leq n,m,q \\leq 10^{5}$,$1\\leq t \\leq 10^{18}$). <br><br>The second line contains $n$ integers $b_i$, $i \\in [0,n-1]$.<br><br>Each of the next $m$ lines contains $5$ integers: <br><br>$0$ $p_x$ $p_y$ $q_x$ $q_y$($0\\leq$ $p_x$,$p_y$,$q_x$,$q_y$ $\\leq n-1$). <br><br>Each of the next $q$ lines contains $4$ or $5$ integers: <br><br>$1$ $i$ $k$ $v$,<br><br>$2$ $j$ $k$ $v$,<br><br>$3$ $p_x$ $p_y$ $q_x$ $q_y$, <br><br>($0\\leq$ $p_x$,$p_y$,$q_x$,$q_y$,$k$,$v$,$i$,$j$ $\\leq n-1$).<br><br>It is guaranteed that $\\sum n \\le 5 \\times 10^5$, $\\sum m \\le 5 \\times 10^5$, $\\sum q \\le 5 \\times 10^5$, and $p_x \\le q_x,p_y \\le q_y$.","type":"input_format","format":"html"},{"title":"Output","content":"For each query of type $0$ and type $3$, output the only line containing just one integer denoting the answer.<br>","type":"output_format","format":"html"},{"title":"Sample Input","content":"<pre><div style=\"font-family:Courier New,Courier,monospace;\">1\n5 3 1 5\n0 4 3 2 1\n0 0 0 4 4\n1 2 2 1\n2 2 3 2\n3 1 1 3 3\n3 0 0 4 1\n3 0 2 4 2</div></pre>","type":"example","format":"html"},{"title":"Sample Output","content":"<pre><div style=\"font-family:Courier New,Courier,monospace;\">0\n1\n3\n2</div></pre>","type":"example","format":"html"},{"title":"Source","content":" <a href=\"/search.php?field=problem&amp;key=2020+Multi-University+Training+Contest+5&amp;source=1&amp;searchmode=source\"> 2020 Multi-University Training Contest 5 </a> ","type":"source","format":"html"}]}